name: build-project
on: [push]
jobs:
  build-matrix:
      runs-on: ${{ matrix.os }}
      strategy:
        fail-fast: false
        matrix:
          os:
            - ubuntu-latest
            - macos-latest
          compiler:
          - gcc
          - llvm
          - clang
          include:
            - os: "windows-latest"
              compiler: "msvc"
          exclude:
          # macos with gcc does not work with gcc for some reason (works with llvm and clang) so just ignore for now.
            - os: "macos-latest"
              compiler: gcc
      steps:
        - uses: actions/checkout@v2
          with:
            submodules: recursive

        - name: Setup C++ with ${{ matrix.compiler }}
          uses: aminya/setup-cpp@v1
          with:
            compiler: ${{ matrix.compiler }}
            cmake: true

        - name: Prepare Vulkan SDK
          uses: humbletim/setup-vulkan-sdk@v1.2.0
          with:
            vulkan-query-version: latest
            vulkan-components: Vulkan-Headers, Vulkan-Loader
            vulkan-use-cache: true
        
        - name: Setup Ubuntu
          run: sudo apt-get -qq install -y wayland-protocols libxkbcommon-dev libxinerama-dev xorg-dev libudev-dev libxrandr-dev libasound2-dev libjack-dev libglu1-mesa-dev libglib2.0-dev libsndfile1-dev libsamplerate0-dev libpulse-dev libibus-1.0-dev
          if: runner.os == 'Linux'

        - name: Compile
          run: cmake -S . -B build && cmake --build build
name: build-project
on: [push]
jobs:
  build-matrix:
      runs-on: ${{ matrix.os }}
      strategy:
        fail-fast: false
        matrix:
          os:
            - ubuntu-latest
            - macos-latest
          compiler:
          - gcc
          - llvm
          - clang
          include:
            - os: "windows-latest"
              compiler: "msvc"
          exclude:
          # macos with gcc does not work with gcc for some reason (works with llvm and clang) so just ignore for now.
            - os: "macos-latest"
              compiler: gcc
      steps:
        - uses: actions/checkout@v2
          with:
            submodules: recursive

        - name: Setup C++ with ${{ matrix.compiler }}
          uses: aminya/setup-cpp@v1
          with:
            compiler: ${{ matrix.compiler }}
            cmake: true
        
        # - name: Try get vulkan-sdk-config.json Linux
        #   shell: bash
        #   run: | 
        #     curl -o vulkan-sdk-config.json "https://vulkan.lunarg.com/sdk/config/latest/linux/config.json"
        #   if: runner.os == 'Linux'

        # - name: Try get vulkan-sdk-config.json Windows
        #   shell: bash
        #   run: | 
        #     curl -o vulkan-sdk-config.json "https://vulkan.lunarg.com/sdk/config/latest/windows/config.json"
        #   if: runner.os == 'Windows'
        
        # - name: Try get vulkan-sdk-config.json macOS
        #   shell: bash
        #   run: | 
        #     curl -o vulkan-sdk-config.json "https://vulkan.lunarg.com/sdk/config/latest/mac/config.json"
        #   if: runner.os == 'macOS'

        - name: Configure Vulkan SDK
          uses: humbletim/setup-vulkan-sdk@v1.2.0
          with:
            vulkan-query-version: latest
            vulkan-components: Vulkan-Headers, Vulkan-Loader, Glslang, SPIRV-Tools, SPIRV-Headers
            vulkan-use-cache: true

        # - name: Setup Shaderc
        #   shell: bash
        #   run: |
        #     python3 libs/shaderc/utils/git-sync-deps

        
        - name: Install GLFW dependencies Linux
          uses: RpxdYTX/install-glfw-deps@v2
          if: runner.os == 'Linux'

        - name: Compile
          run: cmake -S . -B build && cmake --build build